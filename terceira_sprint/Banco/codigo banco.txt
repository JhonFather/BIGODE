CREATE TABLE Sala (
idSala int PRIMARY KEY identity(1,1),
IdentificacaoSala varchar(50)not null,
)go

CREATE TABLE Sensor (
idSensor int PRIMARY KEY identity(1,1),
identificacaoSensor varchar(50) not null,
fkSala int,
FOREIGN KEY(fkSala) REFERENCES Sala (idSala)
)go

CREATE TABLE Usuario (
idUsuario int PRIMARY KEY identity(100,100),
Email varchar(50) not null,
NomeCompleto varchar(50) not null,
Senha varchar(50) not null,
Telefone varchar(50) null,
usuarioLogin varchar(50) not null,
fkSala int,
FOREIGN KEY(fkSala) REFERENCES Sala (idSala)
)go

CREATE TABLE Dados (
idDados int PRIMARY KEY identity,
datahora datetime,
temperatura varchar(50),
umidade varchar(50),
fkSensor int,
FOREIGN KEY(fkSensor) REFERENCES Sensor (idSensor),
)go
/*
insert into Sala values
('salaA'),
('salaB')go
-- select * from Sala;

insert into Sensor values
('sensorA',1),
('sensorB',1),
('sensorA',2),
('sensorB',2)go
-- select * from Sensor;

insert into Usuario values
('pedro.silva@gmail.com', 'Pedro da Silva', 'pedro123','9999-0000','psilva',1),
('rayssa.morais@gmail.com', 'Rayssa de Morais','rayssa123', '8888-3333','rmorais',1),
('roberto.siqueira@gmail.com', 'Roberto Siqueira','7777-2222', 'roberto123','rsiqueira',2)go
-- select * from Usuario;

insert into Dados values
('2019-07-04 17:50',20,44,1),
('2019-07-04 17:50',21,43,2),
('2019-07-03 17:40',21,45,3),
('2019-07-03 17:40',19,43,4)go

-- select * from Dados;
-- Exibir os dados de um determinada sala(informar o nome do sala na consulta) e os dados de seus respectivos usuarios.
select a.* , identificacaoSala
   from  Usuario as a ,Sala
       where idSala = fkSala and identificacaoSala  = 'salaA';
select a.* , identificacaoSala
   from  Usuario as a ,Sala
       where idSala = fkSala and identificacaoSala  = 'salaB';
      
      
-- exibir os dados da tabela dados(mostrando o sensor e a sala da temperatura e umidade)
select d.idDados, d.datahora, d.temperatura, d.umidade , s.identificacaoSensor as [SENSOR],sa.identificacaoSala as [SALA]
    from Dados as d ,Sensor as s, Sala as sa
        where  idSensor = fkSensor and idSala = fkSala;

select * from Dados
        join Sensor on fkSensor = idSensor
       join Sala on fkSala = idSala;

select d.idDados, d.datahora, d.temperatura, d.umidade , s.identificacaoSensor as [SENSOR],sa.identificacaoSala as [SALA]
       from Dados as d
        inner join Sensor as s on fkSensor = idSensor
       inner join Sala as sa on fkSala = idSala
    
/*
drop table Usuario;
drop table Dados;
drop table Sensor;
drop table Sala;
*/